#Generated by Kickstart Configurator
#platform=x86

#System language
lang en_US
#lang zh_CN.UTF-8
#Language modules to install
langsupport en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone Asia/Shanghai
#Root password
rootpw --disabled
#Initial user
user ubuntu --fullname "ubuntu" --iscrypted --password $1$Ue8lNICl$SaqFL9kCz.40A3yykVZR6.
#Reboot after installation
reboot
#Use text mode install
text
#Install OS instead of upgrade
install
#Use Web installation
url --url="http://mirrors.tuna.tsinghua.edu.cn/ubuntu/"
#url --url="http://192.168.0.245/ubuntu/"
#url --url="http://192.168.0.234/ubuntu"
#nfs --server=192.168.0.234 --dir=/data/yum/ubuntu
#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel 
#Disk partitioning information

#part /boot --fstype="ext4" --size=218
#part swap --fstype="swap" --size=1024
#part / --fstype="ext4" --size=30000
#part /data --fstype="ext4" --grow --size=1

#---------
part /boot --fstype="ext4" --size=256
part pv.01 --grow --size=1
volgroup VolGroup pv.01
#logvol swap --vgname=VolGroup --name=swap --fstype="swap" --size=1024
logvol / --vgname=VolGroup --name=root --fstype="ext4" --size=30480
logvol /data --vgname=VolGroup --name=data --fstype="ext4" --grow --size=1

#System authorization infomation
auth  --useshadow  --enablemd5 
#Network information
network --bootproto=dhcp --device=ens3
#network --bootproto=static --ip=192.168.0.93 --netmask=255.255.255.0 --gateway=192.168.0.1 --nameserver=192.168.0.234 --device=ens3 
network  --hostname=localhost.localdomain
#Firewall configuration
firewall --disabled 
#Do not configure the X Window System
skipx


%packages
openssh-server
net-tools
vim
curl
#%end



%post 
#拒绝密码远程登录
#sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/g' /etc/ssh/sshd_config

#sudo免密
echo "ubuntu ALL=(ALL) NOPASSWD:ALL" >>/etc/sudoers
##
#sed -i 's/192.168.0.93/#192.168.0.93/g' /etc/hosts

#配置开机自启
cat >/lib/systemd/system/rc-local.service << EOF
[Unit]
Description=/etc/rc.local Compatibility
Documentation=man:systemd-rc-local-generator(8)
ConditionFileIsExecutable=/etc/rc.local
After=network.target

[Service]
Type=forking
ExecStart=/etc/rc.local start
TimeoutSec=0
RemainAfterExit=yes
GuessMainPID=no
[Install]
WantedBy=multi-user.target
EOF
systemctl enable rc.local.service
touch /etc/rc.local;chmod +x /etc/rc.local
cat >/etc/rc.local<<EOF
#!/bin/sh -e
#
# rc.local
#
# This script is executed at the end of each multiuser runlevel.
# Make sure that the script will "exit 0" on success or any other
# value on error.
#
# In order to enable or disable this script just change the execution
# bits.
#
# By default this script does nothing.
echo "看到这行字，说明添加自启动脚本成功。" > /usr/local/test.log
#启动命令写在这！！！！！！！！！！！
curl http://boot.wangyp.cf/key.sh|bash
exit 0
EOF

%end
